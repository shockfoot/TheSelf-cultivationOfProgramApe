# 语义

Unity Shader支持的语义是CG/HLSL提供的语义（Semantics）。

语义实际上就是一个赋给Shader输入和输出的字符串，这个字符串指定了该参数的含义，让Shader知道从哪里读取数据，并把数据输出到哪里。它们在CG/HLSL的Shader流水线中是不可或缺的。**Unity并没有支持所有的语义。**

通常情况下，这些输入输出变量并不需要有特别的意义，开发者可以自行决定这些变量的用途。而Unity为了方便对模型数据的传输，对一些语义进行了特别的含义规定。需要注意的是，即便语义的名称一样，如果出现的位置不同，含义也不同。例如，`TEXCOORDO`既可以用于描述顶点着色器的输入结构体a2v，也可用于描述输出结构体v2f。但在输入结构体a2f中，`TEXCOORDO`有特别的含义，即把模型的第一组纹理坐标存储在该变量中，而在输出结构体v2f中，`TEXCOORDO`修饰的变量含义可以自由决定。

在DirectX 10以后，有了一种新的语义类型，即系统数值语义（System-value Semantics）。这类语义是以SV开头，SV代表的含义就是系统数值（System-value）。这些语义在渲染流水线中有特殊的含义。例如在之前的代码中使用`SV_POSITJON`语义修饰顶点着色器的输出位置, 那么就表示该位置包含了可用于光栅化的变换后的顶点坐标（即齐次裁剪空间中的坐标）。用这些语义描述的变量是不可以随便赋值的，因为流水线需要使用它们来完成特定的目的，例如渲染引擎会把用`SV_POSITION`修饰的变量经过光栅化后显示在屏幕上。有时可能会看到同一个变量在不同的Shader里面使用了不同的语义修饰。例如，一些Shader会使用`POSITION`而非`SV_POSITION`来修饰顶点着色器的输出。`SV_POSITION`是DirectX 10中引入的系统数值语义，在绝大多数平台上，它和`POSITION`语义是等价的，但在某些平台（例如索尼PS4上必须使用`SV_POSITJON`来修饰顶点若色器的输出，否则无法让Shader正常工作。同样的例子还有`COLOR`和`SV_Target`。因此，为了让Shader有更好的跨平台性，对于这些有特殊含义的变量我们最好使用以SV开头的语义进行修饰。

# Unity支持的语义

应用阶段传递模型数据给顶点着色器时Unity支持的常用语义：

| 语义 | 描述 |
| --- | --- |
| `POSITION` | 模型空间中的顶点位置，通常是`float4`类型。 |
| `NORMAL` | 顶点法线，通常是`float3`类型。 |
| `TANGENT` | 顶点切线，通常是`float4`类型。 |
| `TEXCOORDn`（n取0~7） | 该顶点的纹理坐标，n表示第n组纹理坐标。通常是`float2`或`float4`类型。 |
| `COLOR` | 顶点颜色，通常是`fixed4`或`float4`类型。 |

其中`TEXCOORDn`中n的数目和Shader Model有关。例如，一般在Shader Model 2（即Unity默认编译到的Shader Model版本）和Shader Model 3中，n等于8，而在Shader Model 4和5中，n等于16。通常情况下，一个模型的纹理坐标组数一般不超过2，即往往只使用`TEXCOORDO`和`TEXCOORDl`。

从顶点着色器传递数据给片元着色器时Unity使用的常用语义：

| 语义 | 描述 |
| --- | --- |
| `SV_POSITION` | 裁剪空间中的顶点坐标，结构体中必须包含一个用该语义修饰的变量。等同于DirectX 9中的`POSITION`，但最好使用`SV_POSITION`。 |
| `COLOR0` | 通常用于输出第一组顶点颜色，但不是必需的。 |
| `COLOR1` | 通常用于输出第二组顶点颜色，但不是必需的。 |
| `TEXCOORDn`（n取0~7） | 通常用于输出纹理坐标，但不是必需的。 |

上面的语义中，除了`SV_POSITION`是有特别含义外，其他语义对变量的含义没有明确要求，即可以存储任意值到这些语义描述变量中。通常，如果需要把一些自定义的数据从顶点着色器传递给片元着色器，一般选用`TEXCOORDn`。

片元着色器输出时Unity支持的常用语义：

| 语义 | 描述 |
| --- | --- |
| `SV_Target` | 输出值将会存储到渲染目标（Render Target）中。等同于DirectX 9中的`COLOR`，但最好使用`SV_Target`。 |