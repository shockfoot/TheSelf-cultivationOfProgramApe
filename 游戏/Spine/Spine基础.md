# 简介

Spine是一款针对游戏开发的2D骨骼动画编辑工具，旨在提供更高效和简洁的工作流程，以创建游戏所需的动画。

在Spine中通过将图片绑定到骨骼上，然后再控制骨骼实现动画。2D骨骼动画相对于传统的逐帧动画有以下优势：

- 内存占用少：传统的动画需要提供每一帧图片，而Spine动画只保存骨骼的动画数据，它所占用的空间非常小。
- 美术需求低：Spine动画需要的美术资源更少，能节省出更多的人力物力更好的投入到游戏开发中去。
- 流畅性高：Spine动画使用差值算法计算中间帧，能让动画保持流畅的效果。
- 可灵活更换：图片绑定在骨骼上来实现动画。如果需要可以方便的更换以满足不同的需求，甚至可以重用骨骼。
- 可混合：动画之间可以混合。
- 可程序控制：可通过代码控制骨骼。

Spine官网：https://zh.esotericsoftware.com/

Github：https://github.com/EsotericSoftware/spine-runtimes

# 界面

Spine使用硬件加速并以高帧率渲染，类似于游戏的构建方式，因此速度非常快，动画效果非常流畅。

## 菜单栏

单击Spine窗口左上角的Spine标志可访问Spine的主菜单。在主菜单，可以打开和保存项目、导入和导出以及设置。

Spine标志旁边是快捷按钮，左边的用于打开和保存项目、撤消和重做以及打开欢迎界面，右边的用于缩放全部视图和视图选择框。

## 视图

默认情况下，Spine的视口在左侧，层级树视图在右侧。其他视图可以通过Spine窗口右上角的视图选择框打开。动画模式比设置模式有更多可用视图，因此请务必选中动画模式中的视图选择框。当前视图不能移出Spine窗口。

### 层级树视图

层级树视图为骨架及其包含的所有内容提供了一个层次结构视图。层级树是使用Spine的核心，有许多功能可以更轻松地导航项目。

层级树上方菜单栏可以用于搜索、筛选骨骼、插槽和附件、展开和收起。眼睛标志可以用于设置对象在视口中的显示和隐藏。钥匙标志用于添加关键帧。

在层级树中选择某个对象后，其属性将显示在层级树的底部。大多数属性的右上角都有三个相同的按钮，分别用于复制、重命名和删除。

#### 图片节点

骨架可以有引用图片文件的附件。骨架每个可独立移动的部分都需要是一个单独的图片文件。

设置骨骼的第一步是将每个图片作为区域附件引入，这是一个附加到骨骼上的简单矩形图片。但是，在创建区域附件之前，Spine需要知道在哪里可以找到骨骼的图片文件。图片节点就是用来显示指定路径图片的。

图片节点属性有：

- 路径：引用PGN或JPEG图片文件的路径。可以是项目文件保存位置的相对路径，也可以是绝对路径。可以使用浏览按钮指定路径，也可以输入路径。一旦设置了路径，该文件夹中的图片文件就会出现在图片节点下。Spine会监视该图片文件夹，并会立即加载图片文件的任何更改。
- 限制扫描：默认情况下，只显示在图片文件夹中找到的前2000个图片文件。这可以防止在意外指定错误路径时Spine扫描数百万个文件。取消选中限制扫描可允许Spine查找超过2000个图片文件。

将图片节点下的图片拖拽到视口时，Spine会在根骨骼下创建一个插槽和一个区域附件。还可以将图片拖动到层级树中的骨骼、插槽或附件。如果拖动到骨骼或插槽，则新区域附件会在骨骼上居中。如果拖动到附件，则该附件的变换将应用于新区域附件。

如果没有被任何附件使用，图片节点下的每个图片文件都会有一个红色图标，如果至少被一个附件使用，则显示一个绿色图标。

**Spine通过查找图片节点下指定的路径并附加附件名称来查找附件的图片文件**。附件名称不需要包含文件扩展名。Spine将查找文件扩展名为.png、.jpg或.jpeg的文件。

例如，图片路径为./images/，附件名称为head，Spine将查找./Image/head.png、./Image/head.jpg和./Image/head.jpeg。某些操作系统区分大小写。

附件名称可以包含子文件夹。例如，图片路径为./images/，附件名称为red/head，Spine会查找./image/red/head.png。

如果附件设置了路径，则使用路径而不是附件名称来查找图片文件。**同一插槽下的两个附件不能有相同的名称，但它们可以有相同的路径**。

#### 绘制顺序节点

绘制顺序节点通常用于控制插槽中附件的绘制顺序，**位置较高的在下面的附件之上绘制**。绘制顺序可以通过拖动插槽更改，可以设置关键帧。

## 视口

视口是视图外部显示骨骼的空间，是设置骨架及其动画的地方。视口底部的主工具栏可访问各种工具和设置。

- 平移：按住鼠标右键。
- 缩放：使用鼠标滚轮根据鼠标所在位置进行缩放。
- 设置/动画模式切换：单击视口左上角的图标可以在设置模式和动画模式之间切换。设置模式用于创建和配置骨架，而动画模式用于设计动画。

视口下方为主工具栏。

- 选择：Spine使用智能选择系统，只需单击要选择的项目即可在视口中选择该项目。用大多数工具时，在未选中的项目上开始拖动既会选中该项目，又会开始操作它。按住鼠标左键可以框选。点击空白区域或使用空格键可以取消选择。使用Page Up和Page Down可以切换历史选择。可以使用Ctrl+数字为选择分组。
- 变换：可以直接输入新值，可以用`+`输入相对值，也可以在数字上滚动鼠标滚轮、上下拖动或使用上、下键更改值（按住Shift时可以较小的增量调整值）。
- 坐标系：分本地坐标系、父对象坐标系和世界坐标系。
- - 旋转：旋转骨骼的轴心点始终是骨骼的**原点**。在本地坐标系下，其值为相对于父对象的逆时针旋转度数，其中0与父对象的X轴指向相同的方向；在父对象坐标系下显示本地坐标系下的旋转；在世界坐标系下，其值为逆时针旋转度数，0向右，90向上，180向左，270向下。
- - 平移：在本地坐标系下，其值为相对于父对象的距离，X轴指向旋转方向；在父对象坐标系下其值为相对于父对象的距离，X轴指向父对象的旋转方向；在世界坐标系下，其值为到世界原点的距离。
- - 缩放：在本地坐标系下，其值为相对于缩放，X轴指向旋转方向；在父对象坐标系下显示本地坐标系下的缩放；在世界坐标系下，其值为自己与所有父对象的组合缩放。
- 姿势：可以同时调整骨骼平移和旋转。
- 权重：与权重视图结合使用，可以设置骨骼对网格顶点的影响。
- 创建：可创建新骨骼，只能在设置模式下使用。在创建新骨骼之前，首先选择将成为父骨骼的骨骼。接下来，单击可创建**零长度骨骼**，或拖动以创建骨骼并设置其长度。
- 显示选项：可以方便地查看骨骼和附件的禁用选择、可见性和名称标记。
- 标尺：标尺单位采用世界坐标系，与尚未缩放的图片的像素相对应。
- 缩放：缩放级别由视口左下角的垂直滑块指示。滑块下方是两个缩放按钮。放大镜按钮会放大到100%，因此图片以其实际大小显示。方框按钮可调整缩放级别，以便骨架填充视口。

在视口中的任意位置单击鼠标右键将在当前工具和上一个选定工具之间切换。

# 概念

## 骨架

骨架（Skeleton）表示可设置动画的角色或对象。它包含骨骼（Bone）、插槽（Slot）、附件（Attachment）、动画（Animation）和其他部分，这些都显示在层级树视图中。

骨架有属性：

- 导出：取消勾选时，骨架将完全不会被导出，也不会导出任何JSON或二进制数据，也不会出现在图片或视频导出中。

**骨架隐藏后所有资源都将被卸载，并且该骨架不会显示在视口、曲线图、摄影表或其他视图中。隐藏的骨架仍会被导出。**

当项目有多个骨架时，将**按照它们在层级树视图中的显示顺序在视口中绘制**。可以在层级树视图中拖动骨架以更改其绘制顺序。**层级树中位置较高的会在下面的骨架之上绘制**。**在绘制下一个骨架之前，会先完整绘制每个骨架**。在Spine编辑器中，一个骨架不可能在另一个骨架前面绘制某些部位，而在另一个骨架后面绘制其他部位。如果需要，最简单的方法是拆分骨架，或者在运行时拆分骨架渲染。

## 骨骼

Spine中的大多数动画都会用到骨骼，甚至非动画角色的物体骨架也会用到。简单的骨架每张图片可能用一个骨骼。更复杂的骨架可能会将图片绑定到多个骨骼，这样骨骼动起来时图片就会变形。

骨架有一个骨骼层级，并且始终**只有一个根骨骼**。根骨骼下可能有子骨骼，子骨骼下亦可能有子骨骼，依此类推。

骨骼可以添加到皮肤中，如此只有在皮肤可见时骨骼才会激活。

骨骼有属性：

- 变换：旋转、平移、缩放和倾斜。**骨骼的变换会影响其子骨骼**。骨骼变换的这种分层继承使得操作图片变得更容易、更直观。骨骼变换可以通过变换工具进行操作，并且可以设置关键帧。
- - 旋转：对于骨骼，设置模式下的旋转限制为**0-360度**，指示骨骼的指向。在动画模式下，本地旋转可以超出该范围，指示旋转方向和骨骼将进行的完整旋转次数。但是，请注意，当选择世界轴时，即使在动画模式下，旋转也被限制为0-360度，因为它指示骨骼在世界坐标中的指向。在这种情况下，在键入旋转值时，世界轴按钮会亮显为橙色以示提醒。
- - 倾斜：倾斜会导致子骨骼和附件变形，最常用于动画中的少许自然挤压和拉伸。倾斜变形与缩放变形不同，有助于防止动画看起来僵硬或机械化。
- 变换继承：通常，父骨骼的变换会影响其子骨骼。变换继承属性允许不继承部分父级变换（不能禁用受IK约束影响的骨骼的变换继承。）。
- 长度：骨骼的长度仅在使用IK约束、路径约束或自动权重时比较重要，在其他方面与任何其他骨骼完全相同。可使用十字准线图标在视口中绘制零长度骨骼。
- 图标：用于区分层级树和视口中的骨骼。
- 名称：选中后，骨骼的名称始终在视口中渲染(如果它不与另一个名称重叠)，即使未启用名称也是如此。可以单击该名称以选择骨骼。
- 选择：取消选中时，将无法在视口中选择骨骼。如果在层级树中将其选中，则它在视口中仍将处于选中状态。
- 颜色：用于区分层级树和视口中的骨骼。
- 设置父级：通过单击设置父骨骼或按P键，然后单击层级树或视口中的新父骨骼，可以更改骨骼的父骨骼。也可以在层级树中将骨骼拖动到新的父骨骼。
- 添加到皮肤：可将骨骼添加到当前活动的皮肤。如果当前没有任何皮肤处于活动状态，则会禁用该按钮。不能将根骨骼添加到皮肤。
- 拆分：可以将骨骼拆分成多个较小的骨骼。
- - 嵌套：每个新骨骼都是前一个骨骼的子骨骼。取消选中后，所有新骨骼将与原骨骼具有相同的父级。
- - 斐波那契：新骨骼的长度将遵循斐波那契序列，这意味着它们会逐渐变小。取消选中后，新骨骼将具有相同的长度。
- 分离：只在动画模式下显示。选中时，可以为当前动画的平移、缩放或倾斜分别设置X和Y的关键帧。

骨骼隐藏时将不在视口中绘制，也不能在视口中选择，但如果在层级树中选择了骨骼，它仍会在视口中处于选中状态。隐藏骨骼时，它仍将显示在数据导出中，并且仍绘制子骨骼和附件。

骨骼在视口中的绘制顺序取决于它们的**创建顺序**，并且不能更改。**创建的最后一个骨骼将绘制在其他骨骼之上**。骨骼绘制顺序重要的情况很少见。

## 附件

附件用于将图片和其他东西附加到骨骼上。

将附件附加到骨骼上，因此当骨骼变换时，附件也会变换。有些附件是可见的，含有图片，而另一些附件则是概念性的，比如用于检测碰撞的边界框。

附件并不直接附着在骨骼上，而是被分组到一个插槽下，该插槽则被附加到一个骨骼上。插槽控制哪些附件可见以及附件的颜色。

可以将附件添加到皮肤，这样附件就只在皮肤可见时才可见。

附件可分为：

- 区域附件：矩形图片。
- 网格附件：带有图片纹理的多边形。
- 边界框附件：用于运行时物理或执行碰撞检测的多边形。
- 剪裁附件：用于剪裁区域和网格附件渲染的多边形。
- 路径附件：用于沿路径放置骨骼的贝塞尔曲线。
- 点附件：表示空间中的一个点。

所有附件都有的属性：

- 选择：取消选中选择时，不能在视口中选择该附件。如果在层级树中选中，则在视口中仍然会被选中。
- 导出：如果取消选中导出，附件将不会被导出，这意味着它不会在导出的JSON或二进制中，也不会出现在导出的图片或视频中。如果附件未导出并且在动画中设置了关键帧，则不会导出关键帧。如果网格附件未导出，也不会导出其链接网格。
- 名称：选中后，即使未启用名称，附件的名称也始终会在视口中渲染（如果未与其他名称重叠）。可以单击名称选择附件。
- 颜色：对于网格或区域附件，附件颜色会对网格或区域图片进行着色。附件颜色是在设置模式下设置的，不能在动画中设置关键帧，但附件可以通过插槽颜色进一步着色，插槽颜色可以设置关键帧。所有其他附件都不会在运行时渲染，并且附件颜色仅用于Spine编辑器中的可视化。
- 设置父对象：可以通过单击设置父级或按P，然后在层级树或视口中单击新父级来更改附件的父级。还可以在层级树中将附件拖动到新父级，即使在不同的骨架中也是如此。

### 区域附件

区域附件是一个矩形图片。区域附件的变换不能在动画中设置关键帧。而区域附件的骨骼可以设置关键帧。

区域附件特有的属性：

- 路径：当图片路径为空时，将使用区域附件的名称来查找图片。设置图片路径后，将使用该路径而不是区域附件的名称。
- 网格：网格复选框可将区域附件更改为网格附件。

区域附件的平移参考的是图片的中心位置。如果图片与世界坐标（即屏幕像素）对齐很重要，并且图片的尺寸为奇数，则需要将其偏移0.5。

### 网格附件

网格附件是一个有图片纹理的多边形。多边形在图片内部定义，然后可以操纵其顶点以弯曲和变形图片。网格还有一个优点是，多边形可以排除渲染图片的某些部分，从而提升性能。

使用权重变换骨骼时，网格可以自动变形。

网格顶点位置可以在动画中设置关键帧。

网格附件特有的属性：

- 路径：同区域附件。
- 网格：未选中时将更改回区域附件。
- 线框（Wireframe）：选中后，即使未选择网格，也会绘制网格顶点和边。

点击编辑网格按钮将进入编辑模式，用于创建、修改和删除网格的顶点。其中：

- 修改工具允许移动现有顶点，双击可删除顶点。
- 创建工具可通过单击创建新的顶点，通过拖动创建新的边，双击可删除顶点。
- 删除工具可通过单击删除顶点或边。
- 新建工具将删除所有顶点，并进入新建顶点模式，此时允许通过单击创建新顶点来定义网格。
- 重置工具将删除所有顶点，并用4个顶点替换它们，每个角一个顶点，且移除所有权重并删除动画中的所有变形关键帧。
- 生成工具将在最有利于变形的位置向网格添加新顶点，且移除所有权重并删除动画中的所有变形关键帧。可以多次点击生成来添加越来越多的顶点。已经存在的顶点不会移动，因此在图片中重要特征周围手动添加顶点后，可以使用生成自动填充网格。
- 描绘（Trace）工具将将自动创建网格，且移除所有权重并删除动画中的所有变形关键帧。可以进行一些设置来影响网格的创建方式：
- - 细节：控制使用的顶点数。
- - 凹面：控制将顶点放置到凹形区域的优先级。
- - 细化：控制寻找最优解所花费的时间和精力。
- - Alpha阈值：导致Alpha值低于阈值的像素被忽略。
- - 填充：在图片和外壳之间增加空间。
- - 刷新：使用相同的设置重复创建，每次创建的方式略有不同。
- 三角形：选中后，将在顶点之间绘制虚线，以显示网格的三角化方式。三角剖分确定网格的变形方式。查看三角形有助于决定哪里需要边。
- 变暗（Dim）：选中后，网格图片将变暗，以便可以更容易地看到顶点、边和三角形。
- 隔离：选中后，不会绘制其他附件，可以更容易地看到网格。
- 变形：选中后，网格将显示为超出编辑模式。移动顶点时，它会更改编辑模式之外的顶点位置和纹理坐标。顶点位置仅限于图片边界，当接近边界时会出现灰色线条。如果取消选中该选项，则显示整个网格图片时不会发生任何变形。顶点显示在绘制网格时将用于顶点的图片位置。这称为“纹理坐标”或UV。移动顶点时，它会更改纹理坐标，但不会更改编辑模式之外的顶点位置。
- 边：除了顶点之外，网格还有作为顶点之间连接的“边”。Spine会自动处理网格周围的边。而在网格内部，Spine会自动将所有顶点与边连接起来，当选中三角形时，在编辑模式下显示为灰色虚线。**顶点之间的边决定移动顶点时网格将如何变形**。可以在网格内围绕图片上的特征添加顶点和边，以控制它们的变形方式。自动计算的边（灰色）永远不会与手动边（橙色）相交，因此手动指定边可以完全控制顶点的连接方式。

冻结按钮将当前顶点位置的旋转设置为0，缩放设置为1。网格实际上没有旋转或缩放。它只有几个顶点，每个顶点都有一个位置。为了方便起见，Spine提供了旋转和缩放值，以实现与其他附件类似的操作。当在整个附件上使用旋转或缩放工具时，会调整旋转和缩放。网格也没有平移。显示的平移值参考的是多边形的质心。

重置按钮可移动网格的顶点位置以匹配UV，以防止网格变形。顶点将与在取消选中变形的情况下在编辑模式中定义的UV匹配。由于为顶点指定了新位置，网格如果变形就可能会移动位置，所以将从网格中**移除所有权重，并删除动画中的所有变形关键帧**。

## 插槽

插槽是骨骼的子级，骨骼是附件的容器。**在任何给定时间只有一个附件（或没有附件）可见**。插槽只是概念性的，它没有位置，也不会绘制。

插槽中可见的附件可以在动画中设置关键帧。

可使用插槽**对相同类型的附件进行分组**。例如，武器插槽可以有刀、剑、斧等。因为只有武器插槽出现在绘制顺序中，所以即使骨架有数百或数千件武器，绘制顺序列表也可保持简洁。

插槽还可以**将骨骼与绘制顺序分离**，从而允许在一个不同骨骼上的附件上方和下方绘制同一个骨骼上的附件，这可在层级树视图的绘制顺序节点中调整。

插槽有属性：

- 颜色：对插槽的附件进行着色，控制附件的透明度，并且可以设置关键帧。附件有自己的单独颜色，但不能设置关键帧。颜色按钮的左半部分显示带有透明度的颜色。按钮的右半部分显示不透明颜色。单击该按钮可更改颜色和透明度。当动画的颜色和透明度为分离时，会出现两个颜色按钮。单击任一按钮将打开相同的插槽颜色对话框，可以更改透明度和/或颜色。
- 着成黑色：着成黑色可以将图片的深色与浅色分开着色。当与灰度图片一起使用时，可以获得各种各样的彩色图片。它还允许效果，如纯色剪影，反转颜色，超级马里奥无敌之星闪烁，等等。使用相加、滤色或正片叠底混合模式时，可以获得其他效果。选中时可为插槽启用着成黑色，并导致出现第二个颜色按钮。第一个颜色按钮设置“浅色”颜色，为图片的浅色部分着色并控制不透明度。第二个颜色按钮设置“黑色”颜色，为图片的较暗部分着色。浅色和深色可以设置关键帧。
- 混合：混合控制插槽附件的像素如何与下面的像素组合。其中，正常为默认设置，采用普通混合；相加即线性减淡。正常以外的混合模式可能会通过增加绘制调用来影响某些游戏工具包的性能。一些游戏工具包在使用相加和预乘透明度渲染时，可以避免增加绘制调用。
- 分离：只在动画模式下显示。选中时，可以为当前动画分别设置颜色和透明度的关键帧。

插槽隐藏时将不在视口中绘制，也不会显示在导出的图片或视频中，但仍能导出到数据。隐藏插槽不能设置关键帧。

## 关键帧

Spine中的动画效果是通过设置“关键帧”来完成的。关键帧定义了一个过渡的开始时间、结束时间和值。关键帧之间的任何位置都可以进行插值。骨架动画效果归结为关键帧定义的姿势和关键帧在时间轴上的位置。

在设置关键帧之前，需要处于动画模式，并通过在层级树视图中设置动画可见或在动画视图中选择它来激活动画。

## 时间轴

在动画模式下，骨骼的姿势来自当前时间轴位置和动画的关键帧。时间轴显示在曲线图、摄影表、时间轴和音频视图上。

一旦设置了关键帧，它们将出现在曲线图或摄影表视图中的时间轴下方。时间轴上的**橙色菱形**指示哪些帧至少有一个关键帧。**橙色垂直线**标记在最后一帧上，决定动画持续时间。

与在视口中平移类似，使用鼠标右键拖动可以左右或上下平移时间轴。在时间轴上滚动鼠标滚轮可以放大或缩小时间轴。摄影表左下角的缩放滑块指示当前缩放级别，可以拖动。在缩放滑块的右边是“缩放关键帧”按钮，它可以缩放时间轴，使所有关键帧都可见。

时间轴位置由青色垂直线表示。时间轴位置可以通过左键单击或拖动来设置。在时间轴中拖动是查看骨架姿势如何随时间变化的一种快捷方式。按住Shift可**禁用帧对齐**。

时间轴被分成名为“帧”的时间单位。使用帧可以更轻松地选择一个离散时间位置并精确地同时设置多个关键帧。默认情况下，时间轴使用30帧/秒，但可以在**播放视图**中进行更改。帧的存在只是为了方便。播放期间，时间轴位置在帧之间移动（除非禁用插值）。可使用比时间轴显示的更高或更低的帧速率播放。

启用重复后，将在动画结束后循环播放。

关键帧可设置的属性有：

- 骨骼变换。
- 插槽附件的显示和隐藏。
- 插槽颜色。
- 绘制顺序。
- 事件。
- 变形关键帧。
- IK约束。
- 变换约束。
- 路径约束。

动画层级树属性中的清理按钮可以删除所有不必要的关键帧。这些关键帧可以安全删除，而不会影响动画中的姿势。这包括在一行中为相同的值多次设置关键帧，设置与设置姿势相同的值的关键帧，以及许多其他情况。

通常在设计动画时随意设置关键帧，然后使用清理会比较方便。使用较少的关键帧可以更轻松地处理动画，并减小导出动画数据的大小，特别是在移除变形关键帧时。此外，关键帧越少，在运行时应用动画所使用的CPU就越少。

# 制作动画

制作动画是一个迭代过程。在制作动画过程中，对关键帧进行可视化并调整其时间和值时，会广泛用到曲线图和摄影表。

有许多创作方法可用于 Spine 设计动画。

- 顺序法（Straight Ahead）：从开始至结束都是按照时间的先后顺序去设置每一帧的姿势。优点在于动作自然流畅，因为帧间的动作类似。缺点在于很容易偏离动画的最终效果，而且创作的时间也要比其他方法长。
- 姿势法（Pose to Pose）：先设置动画最主要的几个姿势，不必过于考虑姿势关键帧的时间轴。 当一个动画的主要姿势确定下来，再对其时间轴进行调整，然后填充主要姿势之间的空缺。这种方法是将重点放在动画最重要的部分。只需很少的工作量，便可反映整个动画的运动轨迹，此时再对动画进行调整会显得更省事。这种方法的难点在于填充主要姿势之间的空缺时，若调整得不够好会导致整个动画的运动轨迹显得不自然。
- 分层法（Layered）：在某个时间仅处理一些特定部分，隐藏其他部分。在创作过程中会完成多次迭代，直到为所有部分均已创建动画。通过分层法可屏蔽干扰，可专注于骨架最重要的部分，这将引导剩余部分的实际动画效果。与姿势法相比，分层法的难点在于需要深入了解身体运动机制，在创作的前期对动画的更改将显得比较困难，容易导致动画部分之间的动作中断。
- 组合法：将多种技术结合使用。

曲线可以调整关键帧之间转换的速度。