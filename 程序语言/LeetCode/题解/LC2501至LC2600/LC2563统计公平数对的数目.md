# LC2563统计公平数对的数目

难度：中等
数据结构：数组
算法：二分查找、三指针

## 题目

给定一个下标从0开始的整数数组nums和两个整数lower和upper。如果(i, j)满足以下情况，那么称(i, j)是一个公平数对。

- 0 <= i < j < n
- lower <= nums[i] + nums[j] <= upper

请返回nums中公平数对的总数目。

示例：

> 输入：nums = [0,1,7,4,4,5], lower = 3, upper = 6
> 输出：6
> 解释：共计6个公平数对：(0,3)、(0,4)、(0,5)、(1,3)、(1,4)和(1,5)。

提示：

- 1 <= nums.length <= 10^5^
- -10^9^ <= nums[i] <= 10^9^
- -10^9^ <= lower <= upper <= 10^9^

## 题解

### 二分查找

用暴力枚举的方法，即双层循环枚举所有数对，因此提示中数据量比较大，会超时，所以需要对算法进行优化。

根据题目，排序不会影响结果，因此可以先排序，然后通过二分查找找到[lower - nums[j], upper - nums[j]]之间的元素个数。

``` csharp
private long CountFairPairs1(int[] nums, int lower, int upper)
{
    Array.Sort(nums);
    long result = 0;
    for (int j = 0; j < nums.Length; j++)
    {
        int r = LowerBound(nums, j, upper - nums[j] + 1);
        int l = LowerBound(nums, j, lower - nums[j]);
        result += r - l;
    }

    return result;
}
private int LowerBound(int[] nums, int right, int target)
{
    int left = -1;
    while (left + 1 < right)
    {
        int mid = left + (right - left) / 2;
        if (nums[mid] < target)
        {
            left = mid;
        }
        else
        {
            right = mid;
        }
    }

    return right;
}
```

时间复杂度：排序需要O(nlogn)，二分查找需要O(logn)，所以时间复杂度为O(nlogn)，n为数组长度。

空间复杂度：空间复杂度为O(1)。

### 三指针

在给数组nums排序后，随着枚举的nums[j]变大，upper − nums[j]和lower − nums[j]都变小，于是可以用三指针来代替二分查找的搜索过程。即使用两个指针left和right分别表示小于等于upper − nums[j]的最大元素位置和小于lower − nums[j]的最大元素位置，那么满足条件的nums[i]就被夹在三个指针当中，作差从而得到答案的数量。

``` csharp
public long CountFairPairs(int[] nums, int lower, int upper)
{
    Array.Sort(nums);

    long result = 0;
    int n = nums.Length;
    int left = n, right = n;
    for (int j = 0; j < nums.Length; j++)
    {
        while (left > 0 && nums[left - 1] >= lower - nums[j])
        {
            left--;
        }
        while (right > 0 && nums[right - 1] > upper - nums[j])
        {
            right--;
        }
        result += Math.Min(right, j) - Math.Min(left, j);
    }

    return result;
}
```

时间复杂度：排序需要O(nlogn)，三指针搜索需要O(n)，所以时间复杂度为O(nlogn)，n为数组长度。

空间复杂度：空间复杂度为O(1)。