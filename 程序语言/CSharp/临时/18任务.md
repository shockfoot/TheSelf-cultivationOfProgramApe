# 任务

任务（Task）表示完成某个单元的工作。这个工作可以在单独的线程中运行，也可以以同步方式启动一个任务。任务也是异步编程中的一种实现方式。

`System.Threading.Tasks`类抽象出了线程功能，在后台使用的`ThreadPool`进行管理。

启动任务的两种方式。

``` C#
// 第一种
TaskFactory tf = new TaskFactory();
Task task = tf.StartNew(TaskMesthod);
// 第二种
Task task = new Task(TaskMethod);
task.Start();
```

## 连续任务

如果一个任务的执行是依赖于另一个任务的，那么需要在该任务执行结束后才能执行相应任务，此时可以使用连续任务。连续任务的后一个任务定义时，参数列表需要传入一个`Task`类型参数以确认之前的任务是否执行完毕。

``` C#
void Test2(Task taskBefore) {}

Task t1 = new Task(FirstTaskMethod);
Task t2 = t1.ContinueWith(SecondTaskMethod); // 此时SecondTaskMethod的参数列表中需要一个Task形参
```

## 任务层次结构

在当前任务中启动一个新任务，相当于新任务是当前任务的子任务。两个任务异步执行。如果父任务执行结束后子任务却未执行完毕，则父任务状态将设置为`WaitForChildToComplete`。只有子任务执行完，父任务状态才被设置为`RunToCompletion`。