# 线性变换

n个变量x和m个变量y之间的关系式：

> y~1~ = a~11~x~1~ + ... + a~1n~x~n~
> ...
> y~m~ = a~m1~x~1~ + ... + a~mn~x~n~

上述关系式表示一个从变量x到变量y的线性变换，线性变换a~ij~的系数构成系数矩阵。当给定了线性变换，其系数矩阵是确定的。反之，如果给出一个线性变换的系数矩阵，则线性变换也就确定。**线性变换和系数矩阵之间存在一一对应的关系。** 可以利用矩阵来研究线性变换，也可以利用线性变换来解释矩阵的含义。

> 线性变化（Liner Transform）：保留矢量加和标量乘的变换，即满足以下两公式：
> f(x) + f(y) = f(x+y)
> kf(x) = f(kx)

系数矩阵为单位矩阵的线性变换叫做**恒等变换**。

线性变换有缩放（Scale）、旋转（Rotation）、错切（Shear）、镜像（Reflection）、正交投影（Orthographic Projection）等。

## 缩放变换

如矩阵，其中k为缩放因子

> kx 0
> 0 ky

对应的线性变换

> x~1~ = kx
> y~1~ = ky

可以看作是xOy平面上将向量OP(x,y)变换为向量OP~1~(x~1~,y~1~)，OP~1~是OP在其所在方向上进行缩放，因此这是一个缩放变换。

对于矩阵

> 1+(k-1)N~x~^2^ (k-1)N~x~N~y~
> (k-1)N~x~N~y~ 1+(k-1)N~y~^2^

可以看作是xOy平面上将向量OP(x,y)沿着N轴进行缩放变换得到向量OP~1~(x~1~,y~1~)。

类似地，在三维坐标系中绕任意轴N缩放的缩放矩阵为：

> 1+(k-1)N~x~^2^ (k-1)N~x~N~y~ (k-1)N~x~N~z~
> (k-1)N~x~N~y~ 1+(k-1)N~y~^2^ (k-1)N~y~N~z~
> (k-1)N~x~N~z~ (k-1)N~z~N~y~ 1+(k-1)N~z~^2^

## 旋转变换

如矩阵

> cosθ -sinθ
> sinθ cosθ

对应的线性变换

> x~1~ = xcosθ - ysinθ
> y~1~ = xsinθ + ycosθ

可以看作是xOy平面上将向量OP(x,y)变换为向量OP~1~(x~1~,y~1~)。

设向量OP的长度为r，辐角为α，有x = rcosα，y = rsinα，可得：

> x~1~ = rcosαcosθ - rsinαsinθ = r(cosαcosθ - sinαsinθ) = rcos(α + θ)
> y~1~ = rcosαsinθ + rsinαcosθ = r(cosαsinθ + sinαcosθ) = rsin(α + θ)

表明向量OP~1~的长度为r，辐角为α+θ。相对于把向量OP逆时针旋转θ角，因此这是一个旋转变换。

类似地，在三维坐标系中绕x轴旋转的旋转矩阵为：

> 1 0 0
> 0 cosθ -sinθ
> 0 sinθ cosθ

绕y轴旋转的旋转矩阵为：

> cosθ 0 sinθ
> 0 1 0
> -sinθ 0 cosθ

绕z轴旋转的旋转矩阵为：

> cosθ -sinθ 0
> sinθ cosθ 0 
> 0 0 1

## 正交投影变换

如矩阵

> 1 0
> 0 0

对应的线性变换

> x~1~ = x
> 0 = y

可以看作是xOy平面上将向量OP(x,y)变换为向量OP~1~(x~1~,0)。由于向量OP~1~是向量OP在x轴上的投影向量，因此这是一个正交投影变换。

# 非线性变换

非线性变换是不同时满足标量乘和矢量加的变换，如平移变换。

## 平移变换

> x~1~ = x + 1
> y~1~ = y + 2

可以看作是xOy平面上将向量OP(x,y)变换为向量OP~1~(x~1~,y~1~)，主要是将x向X方向平移1、y向Y方向平移2，因此这是一个平移变换。

平移变换不满足矢量加和标量乘：

- 有点(1,1)与(2,2)：
- - 1+1 + 2+1 != (1+2) + 1，
- - 1+2 + 2+2 != (1+2) + 2。
- 有k为2和点(1,1)：
- - 2*(1+1) != (2*1)+1
- - 2*(1+2) != (2*1)+2

# 仿射变换

仿射变换（Affine Transform）是合并线性变换和平移变换的变换类型。三维空间下的仿射变换需要使用四阶矩阵表示，该四维空间即为**齐次坐标空间**（Homogeneous Space）。

图形学中常见变换矩阵名称和特效

| 变换名称 | 是线性变换吗 | 是仿射变换吗 | 是可逆矩阵吗 | 是正交矩阵吗 |
| --- | --- | --- | --- | --- |
| 平移变换 | N | Y | Y | N |
| 绕坐标轴旋转的旋转矩阵 | Y | Y | Y | Y |
| 绕任意轴旋转的旋转矩阵 | Y | Y | Y | Y |
| 按坐标轴缩放的缩放矩阵 | Y | Y | Y | N |
| 错切矩阵 | Y | Y | Y | N |
| 镜像矩阵 | Y | Y | Y | Y |
| 正交投影矩阵 | Y | Y | N | N |
| 透视投影矩阵 | N | N | N | N |

## 齐次坐标

齐次坐标（Homogeneous Coordinate）即齐次坐标空间下的坐标。

对于齐次坐标空间，将一个三维点坐标转换成齐次坐标是把其w分量设为1，将一个向量转换成齐次坐标是把其w分量设为0。这样设置会导致，当使用一个四阶矩阵对一个点进行变化时，平移、旋转、缩放等都会施加于该点，但对于一个向量则会忽略平移效果。

## 基础变换矩阵

在齐次坐标空间下，四阶矩阵可以表示平移、旋转和缩放等变换。把表示纯平移、纯旋转、纯缩放的变换矩阵叫做**基础变换矩阵**。基础变换矩阵可以分解成四个组成部分：**最左上角表示旋转和缩放变换的三阶矩阵、表示平移的三维列向量、三维零行向量、最右下角的标量1。**

**平移矩阵**的构建：基础变换矩阵中三阶矩阵为单位矩阵，三维列向量各分量对应平移分量。

平移矩阵的逆矩阵就是反方向平移得到的矩阵。

**缩放矩阵**的构建：基础变换矩阵中三阶矩阵为主对角矩阵，各分量为缩放分量，三维列向量为零向量。

如果各缩放系数相同则为统一缩放（Uniform Scale），否则为非统一缩放（Nonuniform Scale）。从外观上看，统一缩放不会改变角度和比例信息，非统一缩放会拉伸或挤压模型从而改变角度和比例。

缩放矩阵的逆矩阵是使用原缩放系数的倒数得到的矩阵。缩放矩阵一般不是正交矩阵。

适用于任意方向上的缩放需要进行复合变换，一种方法是将缩放轴变换成标准坐标轴，然后进行缩放，再使用逆变换得到原来的缩放轴朝向。

沿坐标轴方向旋转的**旋转矩阵**的构建：基础变换矩阵中三阶矩阵为旋转矩阵（见前述旋转变换），三维列向量为零向量。

旋转矩阵的逆矩阵是旋转相反角度得到的矩阵。旋转矩阵是正交矩阵，并且多个旋转矩阵之间的串联同样是正交的。

## 复合变换

可以将平移、旋转、缩放组合成一个复杂的变换过程。复合变换可以通过矩阵的串联实现。

如：P~new~ = M~transition~M~rotation~M~scale~P~old~，是对P~old~先进行缩放，然后进行旋转，最后进行平移，得到P~new~。

> **注意**：
> - P为列矩阵，因此左乘变换矩阵，变换顺序从右向左（行矩阵则右乘变换矩阵，变换顺序从左向右）。
> - 由于**矩阵不满足乘法交换律**，因此变换结果依赖于变换顺序，不同变换顺序得到的结果可能不一样。
> - 多数情况下，约定先缩放，再旋转，最后平移。这样做是为了防止平移后再缩放导致的位置换算。
> - 另外，需要注意**旋转的变换顺序**。Unity中旋转顺序是ZXY，即先绕Y轴旋转，然后绕X轴旋转，最后绕Z轴旋转。